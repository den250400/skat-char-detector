**Agile**
<details><summary>Автоматическое создание карты</summary>
![АвтоматическоеСозданиеКарты](uploads/ba49ac9b3b7c74265c27278fa895847b/АвтоматическоеСозданиеКарты.png)
</details>


<details><summary>Следование по маршруту</summary>
![СледованиеПоМаршруту](uploads/328786fcd224b0edf4f7aaac080dfcb9/СледованиеПоМаршруту.png)
</details>

<details><summary>Создание карты</summary>
![СозданиеКарты](uploads/c1e19c5028c65a0f3b3bcdeace24edea/СозданиеКарты.png)
</details>

<details><summary>Создание маршрута</summary>
![СозданиеМаршрута](uploads/8016f274017c13b9395f7aa6caad3723/СозданиеМаршрута.png)
</details>
  
**Deeprobotics**
<details><summary>Автоматическое создание карты</summary>
![АвтоматическоеСозданиеКарты__1_](uploads/39d62dfc6c71e0c32c3ec425a94f62d4/АвтоматическоеСозданиеКарты__1_.png)
</details>

<details><summary>Следование по маршруту</summary>
![СледованиеПоМаршруту__1_](uploads/683071d1a2eacc3c34de5a7cc670c24d/СледованиеПоМаршруту__1_.png)
</details>


<details><summary>Создание карты</summary>
![СозданиеКарты__1_](uploads/701021394b702632bcb6ec866ae3968c/СозданиеКарты__1_.png)
</details>


<details><summary>Создание нового маршрута</summary>
![СозданиеНовогоМаршрута](uploads/3dcb866254284a1c6715ae67f16235a4/СозданиеНовогоМаршрута.png)
</details>

# Описание разработанных нод 
## WayPointClient

`Модуль предназначен для контроля движения робота по маршруту.`

Входящие сообщения: 
* getCommand (std_msgs::Byte)
    Команды от оператора для управления над маршрутом 
    * commandCode.data = 0 - `Отменить все точки маршрута`
    * commandCode.data = 2  - `Отправить робота домой по старому пути со всеми точками, минимальной задержкой и отсутствием точности по повороту`
    * commandCode.data= 5 - `Отправить робота домой по кротчайшему пути`
    * commandCode.data = 7 - `Отправить робота на зарядную станцию`\
* /legOdom (nav_msgs::Odometry)\
    Используется только в роботах DeepRobotics, принимает данные одометрии для последующей фильтрации
* /move_base_simple/goal (geometry_msgs::PoseStamped)\
    Принимает данные о точке назначения для робота от оператора
* /initialPose (geometry_msgs::PoseWithCovarianceStamped)\
    Принимает данные о местоположении робота от оператора

Сервисы:
* /move_base/clear_costmap(std_srvs::Empty)\
    Используется для очистки карты препятствий при получении данные /initialPose

Исходящие сообщения:
* /robot_controll(std_msgs::Byte)\
    Используется для контроля положения ног у шагающих роботов 
	* 101: StandUp
    * 102: Move Robot
    * 103: Stop motion
    * 104: Sleep
    * 105: Cancel Goals
    * 106: GoHome
    * 107: RvizNewGoal
* /reconfigure_signal(vector_config::reconfigure)\
      Используется для динамического изменения параметров движения робота (Скорости и ускорения)
* /odometry_output(nav_msgs::Odometry)\
    Публикует фильтрованные данные одометри, используется только в DeepRobotics
* /tf(tf2_msgs::TFMessage)\
      Публикует данные фильтрованной одометрии в /tf, используется только в DeepRobotics

Параметры:
* WayPointClient/waypoint_on (bool) - параметр указывающий будет ли робот двигаться по машруту или нет 
* WayPointClient/route_name (string) - имя текущего маршрута
* WayPointClient/path_to_route (string) - путь до текущего маршрута


### DynamicReconfigure
Задает параметры движения робота в Teb`е

Входящие сообщения:
*  /reconfigure_signal(vector_config::reconfigure)\
      Принимает данные для параметров скоростей, ускорений и погрешности цели
*  /move_base/TebLocalPlannerROS/parameter_descriptions (dynamic_reconfigure::ConfigDescription)\
      Внутренние параметры Teb`a
*  /move_base/TebLocalPlannerROS/parameter_updates(dynamic_reconfigure::Config)\
      Внутренние параметры Teb`a

Сервисы:
*  move_baseTebLocalPlannerROS\ 
 клиент отвечающий за установку новых параметров
      
### Obstacle
Входящие сообщения:
*  /input_pointcloud(sensor_msgs::PointCloud2) — сообщения содержащие облако точек от камеры глубины
*  /tf(tf2_msgs::TFMessage) - получает данные о положении и ориентации камеры глубины 
Исходящие сообщения:
*  /object_point_cloud (sensor_msgs::PointCloud2) облака точек пренадлежащие большим объектам которые нельзя перешагнуть
*  /ground_point_cloud(sensor_msgs::PointCloud2)  облака точек принадлежащие поверхности земли 
*  /ground_negative_plane(sensor_msgs::PointCloud2) — облака точек принадлежащие вертикальным поверхностям которые нельзя перешагнуть (поверхности ступенек и других высоких предметов)
*  /findObstacle(vector_config::obstacleDataArray) — массив длиной 7 значений содержащий внутри себя поля о преградах которые можно перешагнуть
    * int8 Id — порядковый номер преграды
    * float32 hight — высота преграды
    * float32 width — ширина преграды
    * float32 distance — дистанция до преграды
    * float32 centrPointCloud_y — центр преграды по Y относительно камеры
      
### Параметры:
*  rate_Hz — частота работы модуля
*  max_distance — максимальная дистанция облака точек для обработки 
*  minHeightObject — минимальная высота объекта который возможно перешагнуть
*  maxHeightObject — максимальная высота объекта который возможно перешагнуть

### FlyTrotSwitch
Входящие сообщения:
* /tf(tf2_msgs::TFMessage) - получает данные о положении и ориентации робота
* /findObstacle(vector_config::obstacleDataArray) массив длиной 7 значений содержащий внутри себя поля о преградах которые можно перешагнуть
      
Исходящие сообщения:
* robotControll(std_msgs::Byte) - Используется для контроля положения ног у шагающих роботов 
* reconfigure_signal(vector_config::reconfigure)Используется для динамического изменения параметров движения робота (Скорости и ускорения)

Параметры: 
* minDistance — минимальная дистанция при которой начинаем включать пододку по лестнице 
* maxDistance — максимальная  дистанция при которой начинаем выключать пододку по лестнице 
* minHight - минимальная высота объекта который возможно перешагнуть
* maxHight - максимальная высота объекта который возможно перешагнуть

### SensorService
Подсоединяется и передает сообщение по Ethernet, в формате get запроса 

Сервисы:
* SensorService (bool)— сервис принимает true, для отправки сигнала на  внешнее устройство подключенное по Ethernet, в качестве ответа передает значение float с информацией внутри
      
### UDP
Замена базового pipeline в Deep`ах. Осуществляет передачу данных между платами внутри робота. 

Входящие сообщения:
* /robotControll (std_msgs::Byte)\
    Принимает сообщение со стороны WayPointClient. Переводит робота в другое состояние(лежит/стоит/высокая ходьба и тд)
* /gait_state (deep_msgs::GaitConst)\
    Принимает данные о текущем состоянии робота c платы драйверов

Исходящие сообщения:
* /robot_info(std_msgs::Int16)\
    Данные о текущем состоянии. Опираются на текущую ноду, а не на плату драйверов
    * 0 → робот лежит
    * 1 → робот стоит
    * 2 → робот идет
    * 3 → робот упал(неточная информация)
    * 5 → лестничная походка

### GroundFilter
Модуль предназначен для выделения из общего облака точек те точки, что относятся к земле.

Входящие сообщения: 
* /velodyne_points (sensor_msgs::PointCloud2)\
	Облако точек с лидара
* (ДЛЯ DEEP`ов) /gait_state (deep_msgs::Gait)\
      Положение робота в пространстве(лежит/стоит) для определения пределов по высоте для выделения точек
      
Исходящие сообщения:
* /obstacles(sensor_msgs::PointCloud2)\
	Облако точек содержащее все, кроме земли
* /floor(sensor_msgs::PointCloud2)\
      Облако точек содержащее землю, определяемую алгоритмом внутри ноды

Параметры:
* z_dist : 0.1 Параметр текущей высоты. Для роботов-собак этот параметр отвечает за лежачее положение 
* min_z : -0.4 Параметр минимальной рассматриваемой высоты. Для роботов-собак этот параметр отвечает за лежачее положение 
* max_z : 0.1 Параметр максимальной рассматриваемой высоты. Для роботов-собак этот параметр отвечает за лежачее положение 
* z_distStanding : 0 Параметр только для роботов-собак. Параметр текущей высоты 
* min_zStanding : -1.5 Параметр только для роботов-собак. Параметр минимальной рассматриваемой высоты 
* max_zStanding : 0 Параметр только для роботов-собак. Параметр максимальной рассматриваемой высоты 
* z_dist_increase : 0.1 Параметр определяющий возрастание по высоте от min к max при попытки найти плоскость 
* min_cluster_size : 200 Параметр минимального количества точек для плоскости при первой итерации 
* distance_inside_crop_circle : 0.55 Параметр радиуса внутри которого удаляются все точки. Для отключения поставить 0 
* distance_outside_crop_circle : 5.67 Параметр радиуса вне которого удаляются все точки. Для отключения поставить 0 
* n_planes_try : 1 Параметр, отвечающий за макисмальное количество рассматриваемых плоскостей для фильтрации. Изначально находится одна и относительно нее ищутся другие на основе параметров идущих далее 
* k_min_plane_size : 50 Параметр минимального количества точек для рассмотрения 
* k_min_percentage_size : 0.5 Параметр минимального количества точек в процентах для рассмотрения 
* RNSC_iterations : 500 Параметр количества итераций RANSAC фильтра для нахождения плоскости 
* RNSC_threshold : 0.07 Параметр требуемой точности RANSAC фильтра для определения плоскости 
* k_angle_threshold : 5 Параметр допустимого угла между плоскотями для добавления на рассмотрение фильтра 
* k_min_D : 1.0 Параметр минимального расстояния между плоскостями для добавления на рассмотрение фильтра 
* k_max_D : 1.5 Параметр максимального расстояния между плоскостями для добавления на рассмотрение фильтра

### Multimap
Замена классическому map_server. Позволяет хранить множество карт для их переключения нодой

Исходящие сообщения: 
* /map (nav_msgs::OccupancyGrid)\
	Содержит стандартную карту
* /multimap_server/environments (multimap_server_msgs::Environments)\
      Не используется
* /multimap_server/maps/1/mapsName/map_metadata (nav_msgs::MapMetaData)\
	Не используется 

Сервисы:
* /multimap_server/dump_environments — сбрасывает окружение (не используется)
* /multimap_server/dump_map — сбрасывает карту(должно быть >=1 карты)
* /multimap_server/load_environments — загружает окружение (не используется)
* /multimap_server/load_map — загружает карту поверх текущей

### online_map_saver
модуль сохраняющий карты из топика /map в файл формата .png

Входящие сообщения:
* /map(nav_msgs::OccupancyGrid)\
Содержит стандартную карту

Сервисы
* /save_map 
* string map_service
* string map_filename
* bool use_default_thresholds
* float32 threshold_occupied
* float32 threshold_free
* ---
* bool success
* string msg


### MapSwitcher
Входящие сообщения:
* /tf (tf2_msgs::TFMessage)
    Считывает текущее положение робота
* /tf_static (tf2_msgs::TFMessage)
  
Исходящие сообщения: 
* /initialpose (geometry_msgs::PoseWithCovarianceStamped)\
    Обозначает координаты изначальной позиции при смене карты
* /switch_zone (visualization_msgs::MarkerArray)\
    Отображает зоны перехода на карте

Сервисы:
* /save_switch_data — сохраняет координаты перехода на соседние карты
command: 
    * saveSwitchPosition — сохраняет координаты перехода с текущей карты
    * changeMap — смена карты на map_name
    * saveNewPose — сохраняет координаты робота на новой карте
    * saveData — сохраняет все полученные ранее данные в .json

Параметры: 
* jsonFile — имя смежных карт с данными о точках перехода
* pathAllMaps — путь до всех смежных карт
* currentMapName — имя начальной карты
* xy_tollerance — точность позиционирования в м. 
* yaw_tollerance — точность ориентации в рад.

